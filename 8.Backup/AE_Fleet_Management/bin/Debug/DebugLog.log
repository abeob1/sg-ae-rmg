[10/26/2016 02:35:37][          Recurring Billing ()] Recurring Billing SELECT T0.[DocNum], T0.[U_AE_Bname], T0.[U_AE_Bcode], T0.[U_AE_Vregno], T0.[U_AE_Rno], T0.[U_AE_Contract], case when month(T0.[U_AE_Vdatein]) in ( '10','11')  then ( case when T0.U_AE_Sdate = T0.[U_AE_NXDT] then (T0.[U_AE_Rate]/DATEDIFF(day,U_AE_NXDT,DATEADD(m,1,U_AE_NXDT) ) )*(DATEDIFF(day,U_AE_Sdate,U_AE_Vdatein)+1)  else T0.[U_AE_rate] end ) else T0.[U_AE_rate] end  as 'U_AE_rate', case when month(T0.[U_AE_Vdatein]) in ( '10','11') then ( case when T0.U_AE_Sdate = T0.[U_AE_NXDT] then ('Long Term Return Calculation ' + CHAR(13) + '----------------------------------------' + CHAR(13) + CHAR(13) + 'Monthly Rental          : ' + cast(cast(T0.[U_AE_Rate] as decimal(19,4)) as nvarchar ) + char(13) + 'Days in Billing Cycle   : ' +  cast(DATEDIFF(day,U_AE_NXDT,DATEADD(m,1,U_AE_NXDT) ) as nvarchar) + char(13) +  'Consumed Days         : ' + cast((DATEDIFF(day,U_AE_Sdate,U_AE_Vdatein)+1) as nvarchar) + char(13) + 'Calculated Amount     : ' + cast(cast((T0.[U_AE_Rate]/DATEDIFF(day,U_AE_NXDT,DATEADD(m,1,U_AE_NXDT) ) )*(DATEDIFF(day,U_AE_Sdate,U_AE_Vdatein)+1) as decimal(19,4)) as varchar)) else 'Long Term Recurring Calculation' + CHAR(13) + '----------------------------------------' + CHAR(13) + CHAR(13) + 'Monthly Rental         : ' + cast(cast(T0.[U_AE_rate] as decimal(19,4)) as nvarchar) end ) else 'Long Term Recurring Calculation' + CHAR(13) + '----------------------------------------' + CHAR(13) + CHAR(13) + 'Monthly Rental         : ' + cast(cast(T0.[U_AE_rate] as decimal(19,4)) as nvarchar) end  as 'Cal',  T0.[U_AE_NXDT], T0.[Docentry] , cast('20161001' as datetime)  'U_AE_Sdate' FROM [dbo].[@AE_SBOOKING]  T0  , OINV T1 WHERE  DAY(T0.[U_AE_NXDT]) >= '1' and DAY(T0.[U_AE_NXDT]) <= '1' and T0.[U_AE_Status] = 'Open' and T0.DocNum not in (select rtrim(substring(TT.NumAtCard , 3 , len(Tt.NumAtCard) -2)) from OINV tt where month(tt.DocDate) = '10' and left(TT.NumAtCard,2) = 'SD' and isnull(TT.U_AE_BCC,'N') = 'N'  ) group by T0.[DocNum], T0.[U_AE_Bname], T0.[U_AE_Bcode], T0.[U_AE_Vregno], T0.[U_AE_Rno], T0.[U_AE_Contract], T0.[U_AE_NXDT], T0.[U_AE_Vdatein],T0.[U_AE_Rate], T0.[DocEntry],T0.[U_AE_Sdate] 
